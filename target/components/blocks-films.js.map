{"version":3,"sources":["../../js/components/blocks-films.js"],"names":["blockFilmsWrapper","document","getElementById","renderFilmBlock","posterUrl","filmName","id","wrapper","createElement","classList","add","link","href","img","src","alt","shadow","descWrapper","title","textContent","desc","append","fetchBlockFilms","result","json","films","requests","filmBlocksMap","Map","limit","forEach","film","posterUrlPreview","nameRu","filmId","filmLayout","set","push","Promise","resolve","detailResult","detailsData","description","all","innerHTML","elements","values","slice"],"mappings":"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","sourcesContent":["import { filmDetailsRequest, topfilmsRequest } from '../__data__/api/kinopoiskapiunofficial.js';\r\n\r\nconst blockFilmsWrapper = document.getElementById('block05-films-wrapper');\r\n\r\n// const sleep = ms => {\r\n//   return new Promise(resolve => setTimeout(resolve, ms));\r\n// };\r\n\r\nfunction renderFilmBlock(posterUrl, filmName, id) {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.classList.add('block05__movie');\r\n\r\n    const link = document.createElement('a');\r\n    link.href = `/single/?id=${id}`;\r\n\r\n    const img = document.createElement('img');\r\n    img.classList.add('block05__pic');\r\n    img.src = posterUrl;\r\n    img.alt = 'Изображение постера';\r\n\r\n    const shadow = document.createElement('div');\r\n    shadow.classList.add('block05__shadow');\r\n\r\n    const descWrapper = document.createElement('div');\r\n    descWrapper.classList.add('block05__description');\r\n\r\n    const title = document.createElement('p');\r\n    title.classList.add('block05__text1');\r\n    title.textContent = filmName;\r\n\r\n    const desc = document.createElement('p');\r\n    desc.classList.add('block05__text2', 'paragraph-font');\r\n\r\n    descWrapper.append(title, desc);\r\n    link.append(img, shadow, descWrapper);\r\n    wrapper.append(link);\r\n\r\n    return [wrapper, desc];\r\n}\r\n\r\nconst fetchBlockFilms = async () => {\r\n    const result = await topfilmsRequest();\r\n    const { films } = await result.json();\r\n\r\n    const requests = [];\r\n    const filmBlocksMap = new Map();\r\n\r\n    let limit = 5;\r\n\r\n    films.forEach((film) => {\r\n        if (limit < 1) {\r\n            return;\r\n        }\r\n        limit--;\r\n\r\n        const [filmLayout, desc] = renderFilmBlock(film.posterUrlPreview, film.nameRu, film.filmId);\r\n        filmBlocksMap.set(film.filmId, filmLayout);\r\n\r\n        requests.push(\r\n            new Promise(async (resolve) => {\r\n                const detailResult = await filmDetailsRequest(film.filmId);\r\n                const detailsData = await detailResult.json();\r\n\r\n                const description = detailsData.description;\r\n\r\n                if (!description) {\r\n                    filmBlocksMap.delete(film.filmId);\r\n                } else {\r\n                    desc.textContent = description;\r\n                }\r\n\r\n                resolve();\r\n            })\r\n        );\r\n    });\r\n\r\n    await Promise.all(requests);\r\n\r\n    // let i = 0;\r\n    // for (const [, element] of filmBlocksMap) {\r\n    //     blockFilmsWrapper.append(element)\r\n    //     i++;\r\n\r\n    //     if (i >= 9) {\r\n    //         break;\r\n    //     }\r\n    // }\r\n\r\n    blockFilmsWrapper.innerHTML = '';\r\n\r\n    const elements = [...filmBlocksMap.values()].slice(0, 9);\r\n\r\n    blockFilmsWrapper.append(...elements);\r\n};\r\n\r\nfetchBlockFilms();\r\n"],"file":"blocks-films.js"}